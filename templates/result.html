{% extends "base.html" %}

{% block title %}Quiz Results{% endblock %}

{% block content %}

<style>
    /* Code block styling */
    pre {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 15px;
        overflow-x: auto;
        margin-top: 10px;
        margin-bottom: 10px;
    }

    /* Inline code styling */
    code {
        font-family: Consolas, "Courier New", monospace;
        color: #d63384;
        background-color: rgba(214, 51, 132, 0.1);
        padding: 2px 4px;
        border-radius: 4px;
    }

    .answer-text p { display: inline; margin: 0; }
    .question-text p { margin-bottom: 0.5rem; }
</style>

<div class="container py-5">
    <div class="result-box bg-white p-4 rounded shadow-sm">

        <div class="text-center mb-5">
            <h2 class="mb-2">ðŸŽ‰ Your Score: <span class="text-primary">{{ score }}</span> / {{ total }}</h2>
            
            {% set percentage = (score / total) * 100 %}
            {% if percentage >= 80 %}
                <span class="badge bg-success">Excellent!</span>
            {% elif percentage >= 50 %}
                <span class="badge bg-warning text-dark">Good Job</span>
            {% else %}
                <span class="badge bg-danger">Keep Practicing</span>
            {% endif %}
        </div>
        <hr>

        {% for r in results %}
            <div class="mb-5">

                <div class="mb-3 fw-bold question-text d-flex align-items-start">
                    <span class="me-2 badge bg-light text-dark border">Q{{ loop.index }}</span>
                    <div class="w-100">{{ r.question | markdown | safe }}</div>
                </div>

                {% if q_type == 'MCQ' %}
                    
                    <ul class="list-group mb-3">
                        {% for opt in r.options %}
                            <li class="list-group-item border-0 px-0 py-1">
                                <i class="far fa-circle text-muted me-2 small"></i>
                                <span class="answer-text text-muted">{{ opt | markdown | safe }}</span>
                            </li>
                        {% endfor %}
                    </ul>

                    <div class="row g-2">
                        <div class="col-md-6">
                            <div class="p-3 rounded border {{ 'bg-success bg-opacity-10 border-success' if r.is_correct else 'bg-danger bg-opacity-10 border-danger' }}">
                                <small class="text-uppercase fw-bold {{ 'text-success' if r.is_correct else 'text-danger' }}">Your Answer</small>
                                <div class="mt-1 fw-bold">
                                    {{ r.selected | markdown | safe }}
                                </div>
                            </div>
                        </div>

                        {% if not r.is_correct %}
                        <div class="col-md-6">
                            <div class="p-3 rounded border bg-light">
                                <small class="text-uppercase fw-bold text-success">Correct Answer</small>
                                <div class="mt-1 fw-bold text-success">
                                    {{ r.correct | markdown | safe }}
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                {% else %}
                    
                    <div class="mb-3">
                        <label class="small text-muted fw-bold text-uppercase">Your Submission:</label>
                        {% if q_type == 'Code' %}
                            <pre><code class="language-python">{{ r.selected }}</code></pre>
                        {% else %}
                            <div class="p-3 bg-light rounded border mt-1">
                                {{ r.selected }}
                            </div>
                        {% endif %}
                    </div>

                    <div class="alert {{ 'alert-success' if r.is_correct else 'alert-warning' }} border-0 shadow-sm">
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-robot me-2"></i>
                            <h6 class="mb-0 fw-bold">AI Feedback</h6>
                        </div>
                        <div class="small">
                            {{ r.explanation | markdown | safe }}
                        </div>
                    </div>

                {% endif %}

                {% if q_type == 'MCQ' and r.explanation %}
                    <div class="mt-3 text-muted bg-light p-3 rounded border small">
                        <strong><i class="fas fa-info-circle"></i> Explanation:</strong><br>
                        {{ r.explanation | markdown | safe }}
                    </div>
                {% endif %}

                <hr class="mt-4">
            </div>
        {% endfor %}

        <div class="text-center mt-4">
            <a href="{{ url_for('index') }}" class="btn btn-primary btn-lg shadow-sm">
                ðŸ”„ Take Another Quiz
            </a>
            <a href="{{ url_for('profile') }}" class="btn btn-outline-dark btn-lg ms-2">
                ðŸ‘¤ View Profile
            </a>
        </div>

    </div>
</div>
{% endblock %}